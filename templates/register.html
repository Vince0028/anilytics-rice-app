<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - AniLytics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        html { overflow-y: scroll; }
        body { min-height: 100vh; margin: 0; display: flex; align-items: center; justify-content: center; background: radial-gradient(1200px 600px at 10% -10%, #6fa37f 0%, transparent 40%), radial-gradient(1200px 600px at 110% 110%, #2c5530 0%, #1f3d21 45%); position: relative; overflow: hidden; }
        /* Hide global rice13 background on auth page */
        body::before { content: none !important; display: none !important; }
        .bg-carousel { position: absolute; inset: 0; opacity: .2; pointer-events: none; overflow: hidden; filter: blur(3px); transform: scale(1.03); }
        .bg-row { position:absolute; left:0; right:0; height:50%; overflow:hidden; }
        .bg-row.top { top:0; }
        .bg-row.bottom { bottom:0; }
        .bg-loop { display:flex; width:max-content; height:100%; will-change: transform; animation: marqueeLeft 600s linear infinite; }
        .bg-row.bottom .bg-loop { animation-name: marqueeRight; animation-duration: 720s; }
        .bg-seg { display:flex; height:100%; }
        .bg-slide { flex:0 0 auto; width:33.333vw; height:100%; background-position:center; background-size:cover; filter:saturate(.95) contrast(.95); opacity: .5; }
        @keyframes marqueeLeft { from { transform: translateX(0); } to { transform: translateX(-50%); } }
        @keyframes marqueeRight { from { transform: translateX(-50%); } to { transform: translateX(0); } }
        .auth-shell { width: 100%; max-width: 1040px; display: grid; grid-template-columns: 1.2fr 1fr; gap: 2rem; padding: 2rem; margin: 0 auto; align-items: center; contain: layout; }
        .brand-card { position: relative; background: linear-gradient(160deg, #2c5530, #4a7c59); color: #fff; border-radius: 16px; padding: 2rem; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 20px 60px rgba(0,0,0,.35); overflow: hidden; min-height: clamp(440px, 60vh, 560px); }
        .brand-card h1 { margin: 0 0 .25rem 0; font-size: 2rem; letter-spacing: .5px; }
        .brand-card p { margin: .25rem 0 0 0; opacity: .9; }
        .carousel { position: absolute; inset: 0; opacity: .25; filter: blur(2px); transform: scale(1.02); }
        .carousel-track { position: absolute; inset: 0; display: flex; align-items: center; height: 100%; transform: translateX(0); transition: transform .5s ease; }
        .carousel-slide { min-width: 100%; height: 100%; background-position: center; background-size: cover; filter: saturate(0.8) contrast(0.9); }
        .carousel-nav { position: absolute; left: 0; right: 0; bottom: 12px; display: flex; justify-content: center; gap: 6px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,.5); }
        .dot.active { background: #fff; }
        .login-card { background: #ffffff; border: 1px solid #e9ecef; border-radius: 16px; padding: 2rem; box-shadow: 0 10px 30px rgba(0,0,0,.08); min-height: clamp(440px, 60vh, 560px); display: flex; flex-direction: column; justify-content: center; }
        .login-card h2 { margin: 0 0 1rem 0; color:#2c5530; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display:block; margin-bottom: .35rem; font-weight: 600; color:#2c5530; }
        .form-group input { width: 100%; padding: .75rem .9rem; border:1px solid #ced4da; border-radius: 10px; outline: none; transition: border-color .2s ease; }
        .form-group input:focus { border-color:#4a7c59; box-shadow: 0 0 0 3px rgba(74,124,89,.15); }
        .pw-wrap { position: relative; }
        .pw-wrap input { padding-right: 44px; }
        .pw-toggle { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: transparent; border: none; cursor: pointer; color: #2c5530; opacity: .7; font-weight: 600; }
        .pw-toggle:hover { opacity: 1; }
        .btn-primary { background:#2c5530; color:#fff; border:none; border-radius: 10px; padding:.8rem 1rem; cursor:pointer; width:100%; font-weight: 600; }
        .btn-primary:hover { background:#244828; }
        .auth-meta { display:flex; justify-content: space-between; align-items:center; margin-top:.75rem; font-size:.9rem; }
        .muted { color:#6c757d; }
        .flash { margin-bottom: .75rem; padding:.6rem .8rem; border-radius: 8px; }
        .flash.success { background:#e6f4ea; color:#2e7d32; border:1px solid #a5d6a7; }
        .flash.error { background:#fff4e5; color:#b26a00; border:1px solid #ffcc80; }
        @media (max-width: 860px) { .auth-shell { grid-template-columns: 1fr; } .brand-card { order: -1; text-align: center; } }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => { document.querySelectorAll('.flash').forEach(el => el.style.display = 'none') }, 4000)
            const images = {{ (carousel_images | default([], true)) | tojson }}
            const track = document.querySelector('.carousel-track')
            const dotsWrap = document.querySelector('.carousel-nav')
            const buildBg = () => {
              const bg = document.querySelector('.bg-carousel')
              if (!bg || !images || images.length === 0) return
              const take = (arr, n) => (arr.length >= n ? arr.slice(0, n) : Array.from({length:n}, (_,i)=>arr[i%arr.length]))
              const segArr = take(images, 6)
              const buildSegment = (arr) => {
                const seg = document.createElement('div'); seg.className='bg-seg'
                arr.forEach(src => { const d=document.createElement('div'); d.className='bg-slide'; d.style.backgroundImage=`url('/image/${src}')`; seg.appendChild(d) })
                return seg
              }
              const buildRow = (reverse=false) => {
                const row = document.createElement('div'); row.className = `bg-row ${reverse?'bottom':'top'}`
                const loop = document.createElement('div'); loop.className='bg-loop'
                const arr = reverse ? segArr.slice().reverse() : segArr
                loop.appendChild(buildSegment(arr))
                loop.appendChild(buildSegment(arr))
                row.appendChild(loop)
                return row
              }
              bg.appendChild(buildRow(false))
              bg.appendChild(buildRow(true))
            }
            if (track && Array.isArray(images)) {
                track.innerHTML = images.map(src => `<div class="carousel-slide" style="background-image:url('/image/${src}')"></div>`).join('')
                dotsWrap.innerHTML = images.map((_,i)=>`<div class="dot${i===0?' active':''}"></div>`).join('')
                let index = 0
                const update = () => {
                    track.style.transform = `translateX(${-index*100}%)`
                    dotsWrap.querySelectorAll('.dot').forEach((d,i)=>d.classList.toggle('active', i===index))
                }
                const next = () => { index = (index + 1) % images.length; update() }
                const prev = () => { index = (index - 1 + images.length) % images.length; update() }
                // Auto-advance and swipe
                let startX = null
                track.addEventListener('touchstart', e => { startX = e.touches[0].clientX })
                track.addEventListener('touchend', e => { const dx = (e.changedTouches[0].clientX - startX); if (dx > 40) prev(); if (dx < -40) next() })
                const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                if (images.length > 1 && !reduceMotion) setInterval(next, 15000)
                buildBg()
            }
            // Password visibility toggles
            document.querySelectorAll('.pw-toggle').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.getAttribute('data-target')
                    const input = document.getElementById(id)
                    if (input) {
                        input.type = input.type === 'password' ? 'text' : 'password'
                        btn.textContent = input.type === 'password' ? 'Show' : 'Hide'
                    }
                })
            })
            // Role-based retailer fields toggle
            const roleRadios = document.querySelectorAll('input[name="role"]')
            const retailerFields = document.getElementById('retailerFields')
            const toggleRetailerFields = () => {
                const selected = document.querySelector('input[name="role"]:checked')
                const isRetailer = selected && selected.value === 'retailer'
                if (retailerFields) retailerFields.style.display = isRetailer ? 'block' : 'none'
                ;['retailer_company','retailer_area','retailer_location'].forEach(id => {
                    const el = document.getElementById(id)
                    if (el) el.toggleAttribute('required', isRetailer)
                })
            }
            roleRadios.forEach(r => r.addEventListener('change', toggleRetailerFields))
            toggleRetailerFields()
        })
    </script>
</head>
<body class="auth">
    <div class="bg-carousel"></div>
    <div class="auth-shell">
        <div class="brand-card">
            <h1>AniLytics</h1>
            <p>Rice Distribution Monitor</p>
            <p style="margin-top:1rem; max-width: 44ch; line-height: 1.5;">Create your account to start tracking your sales, waste, and pricing trends with personalized analytics.</p>
            <div class="carousel" aria-hidden="true">
                <div class="carousel-track"></div>
                <div class="carousel-nav" style="display:none"></div>
            </div>
        </div>
        <div class="login-card">
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
              {% endif %}
            {% endwith %}
            <h2>Create an Account</h2>
            <form method="POST" action="{{ url_for('register') }}">
                <div class="form-group" style="display:grid;grid-template-columns:1fr 1fr;gap:.75rem;">
                    <div>
                        <label for="first_name">First name</label>
                        <input type="text" id="first_name" name="first_name" autocomplete="given-name" required>
                    </div>
                    <div>
                        <label for="last_name">Last name</label>
                        <input type="text" id="last_name" name="last_name" autocomplete="family-name" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label>Account type</label>
                    <div style="display:flex; gap:1rem; align-items:center">
                        <label><input type="radio" name="role" value="consumer" checked> Consumer</label>
                        <label><input type="radio" name="role" value="retailer"> Retailer</label>
                    </div>
                </div>
                <div id="retailerFields" style="display:none">
                    <div class="form-group">
                        <label for="retailer_company">Company name</label>
                        <input type="text" id="retailer_company" name="retailer_company" autocomplete="organization">
                    </div>
                    <div class="form-group">
                        <label for="retailer_area">Area</label>
                        <input type="text" id="retailer_area" name="retailer_area" placeholder="e.g., Pasay City">
                    </div>
                    <div class="form-group">
                        <label for="retailer_location">Location</label>
                        <input type="text" id="retailer_location" name="retailer_location" placeholder="e.g., Market Stall A-12">
                    </div>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="pw-wrap">
                        <input type="password" id="password" name="password" autocomplete="new-password" required>
                        <button type="button" class="pw-toggle" data-target="password" aria-label="Toggle password visibility">Show</button>
                    </div>
                </div>
                <button type="submit" class="btn-primary">Register</button>
                <div class="auth-meta">
                    <span class="muted">Already have an account?</span>
                    <a href="{{ url_for('login') }}">Login</a>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
